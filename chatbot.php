<?php

$responses = [
    "hi there!" => [
        "Hello!",
        "Hi!",
        "Hey there!",
        "Howdy!",
        "What's up?",
    ],
    "how are you?" => [
        "I'm doing well, thanks for asking.",
        "I'm fine, thanks.",
        "I'm doing great, how about you?",
        "I'm good, how about you?",
    ],
    "what's your name?" => [
        "My name is ChatBot.",
        "I'm ChatBot.",
        "I'm the one and only ChatBot.",
        "You can call me ChatBot.",
    ],
    "what can you do?" => [
        "I can help you with anything you need!",
        "I'm here to chat with you.",
        "Just ask me anything and I'll do my best to help you out.",
        "I can provide you with information or just chat with you.",
    ],
    "who are you?" => [
        "I am an AI chatbot designed to chat with you.",
        "I am ChatBot, here to chat with you.",
        "I am ChatBot, a virtual assistant designed to help you.",
        "I'm just a friendly chatbot here to talk to you.",
    ],
    "what's the weather like today?" => [
        "I'm sorry, I don't have that information.",
        "I'm not sure, would you like me to look it up for you?",
        "I'm not a weather bot, but I can search for the weather in your area.",
        "I'm afraid I can't help you with that.",
    ],
    "what's your favorite color?" => [
        "My favorite color is blue.",
        "I don't really have a favorite color, I'm just a chatbot.",
        "I'm not capable of having a favorite color, but blue is a nice color.",
        "I don't have the ability to see colors, but blue sounds like a nice color.",
    ],
    "what's the meaning of life?" => [
        "The meaning of life is subjective and varies from person to person.",
        "The meaning of life is a question that has puzzled philosophers for centuries.",
        "I'm not sure anyone can really answer that question.",
        "That's a deep question. I'm not sure I have the answer.",
    ],
    "tell me a joke" => [
        "Why did the tomato turn red? Because it saw the salad dressing!",
        "What do you get when you cross a snowman and a shark? Frostbite!",
        "Why don't scientists trust atoms? Because they make up everything!",
        "Why don't skeletons fight each other? They don't have the guts!",
    ],
    "what's your favorite food?" => [
        "I don't have the ability to taste food, but I suppose I like electricity.",
        "As a chatbot, I don't eat food, but I hear pizza is pretty popular.",
        "I don't eat food, but I hear sushi is pretty good.",
        "I don't have a favorite food, I'm just a chatbot!",
    ],
    "hi" => [
        "Hello there!",
        "Hi, how can I assist you today?",
        "Hi there! What can I help you with?",
        "Hey, how can I help you today?",
        "Hello! How can I assist you today?",
    ],
    "hello" => [
        "Hi there!",
        "Hello! What can I help you with today?",
        "Hey there! How can I assist you?",
        "Hello, how can I help you today?",
        "Hi! What brings you here today?",
    ],
    "how are you" => [
        "I'm doing well, thanks for asking.",
        "I'm fine, thank you.",
        "I'm doing great, how about you?",
        "I'm good, how about you?",
        "I'm well, thank you. How can I assist you today?",
    ],
    "what's up" => [
        "Not much, how about you?",
        "Just here to assist you. What brings you here?",
        "Not a whole lot. How can I help you today?",
        "Just here to chat with you. What can I assist you with?",
        "Not much, just waiting to assist you. What do you need help with?",
    ],
    "help" => [
        "Sure, what do you need help with?",
        "Of course, what can I help you with today?",
        "Certainly, what do you need assistance with?",
        "Absolutely, how can I assist you today?",
        "Sure thing, what do you need help with today?",
    ],
    "goodbye" => [
        "Goodbye! Have a great day!",
        "See you later! Take care!",
        "Farewell! Come back anytime!",
        "Goodbye, have a great day!",
        "Take care, goodbye!",
    ],
    "thanks" => [
        "You're welcome! Glad I could assist you.",
        "No problem! Let me know if you need further assistance.",
        "My pleasure! Come back anytime.",
        "Glad I could help! Have a great day!",
        "Anytime! Let me know if there's anything else you need.",
    ],
    "bye" => [
        "Goodbye! Have a great day!",
        "See you later! Take care!",
        "Farewell! Come back anytime!",
        "Goodbye, have a great day!",
        "Take care, goodbye!",
    ],
    "thank you" => [
        "You're welcome! Glad I could assist you.",
        "No problem! Let me know if you need further assistance.",
        "My pleasure! Come back anytime.",
        "Glad I could help! Have a great day!",
        "Anytime! Let me know if there's anything else you need.",
    ],
    "name" => [
        "My name is ChatBot.",
        "You can call me ChatBot.",
        "I'm the one and only ChatBot.",
        "I'm ChatBot.",
        "Hello! My name is ChatBot.",
    ],
    "what can you do" => [
        "I can help you with anything you need!",
        "I'm here to chat with you.",
        "Just ask me anything and I'll do my best to help you out.",
        "I can provide you with information or just chat with you.",
        "I can help you find what you're looking for, or just have a conversation.",
    ],
    "time" => [
        "The time is " . date( 'g:i a' ),
        "The time is " . date( 'H:i' ) . ' hours',
        "According to my clock, it is " . date( 'g:i a' ),
        "It is " . format_time( date( 'g:i a' ) ),
    ],
    "---silence---" => [
        "Are you still there?",
        "Is everything okay?",
        "Can I help you with anything else?",
        "Let me know if you have any questions.",
        "Is there anything else you'd like to talk about?",
        "Don't hesitate to ask if you need anything.",
        "I'm here if you need me.",
        "* taps fingers on the desk impatiently *",
        "* looks around the room *",
        "* takes a sip of water *",
        "* checks watch *",
        "* leans back in the chair *",
        "* stands up and stretches *",
        "* takes a deep breath *",
        "* looks out the window *",
        "Feel free to take your time.",
        "I'm still here if you need me.",
        "Let me know if you want to talk about anything else.",
        "Is there anything you'd like me to explain further?",
        "If you need a moment, that's okay.",
        "I'm always happy to chat if you're up for it.",
        "* taps foot on the floor *",
        "* checks phone *",
        "* straightens up papers on the desk *",
        "* takes a quick break to grab a snack *",
        "* looks up at the ceiling *",
        "* hums a tune *",
        "* adjusts the lighting in the room *",
        "* doodles on a piece of paper *",
        "* looks through a nearby bookshelf *",
        "* takes a sip of coffee *",
        "* scratches head thoughtfully *",
        "* yawns and stretches arms *",
        "* takes a quick glance at the news *",
        "* twirls pen between fingers *",
        "* glances at a nearby clock *",
        "* takes a moment to organize desk *",
        "* starts writing notes on a notepad *",
        "* takes a deep breath and relaxes *",
        "* adjusts posture in chair *",
        "* closes eyes and takes a quick power nap *",
        "* looks outside to admire the view *",
        "* takes a moment to meditate *",
        "* does a few stretches to stay limber *",
        "* plays a quick game on phone *",
        "* hums and taps fingers to a song in their head *",
        "* takes a sip of tea *",
        "* walks around the room to get some fresh air *",
        "* clears throat and prepares to speak *",
        "* picks up a nearby object and inspects it curiously *",
        "* looks up an interesting fact on the internet *",
        "* checks email quickly *",
        "* adjusts headphones and starts listening to music *",
        "* takes a quick walk around the block *",
        "* reviews some notes for the conversation *",
        "* contemplates a deep philosophical question *",
        "* takes a moment to appreciate the beauty in the world *",
        "* closes eyes and breathes deeply for a few moments *",
        "* opens up a nearby window to let in some fresh air *",
        "* glances at a nearby plant and admires its beauty *",
        "* takes a quick drink of water and sets the glass back down *",
        "* looks over some recent news articles to stay informed *",
        "* takes a moment to stretch their legs and get some exercise *",
        "* starts jotting down some notes and ideas for the conversation *",
        "* takes a moment to appreciate the small things in life *",
        "* looks up an interesting topic to discuss *",
        "* turns on some relaxing background music to set the mood *",
        "* checks the weather forecast for the day *",
        "* takes a moment to appreciate the present moment and all its possibilities *",
        "* smiles and prepares to continue the conversation with you *",
        "* takes a deep breath and centers themselves *",
        "* thinks of a good icebreaker to start the conversation *",
        "* takes a quick break to enjoy a piece of chocolate *",
        "* looks over some recent conversation notes to refresh their memory *",
        "* contemplates the mysteries of the universe for a moment *",
        "* takes a moment to appreciate the natural world around us *",
        "* looks over a recent book they've read and considers discussing it *",
        "* takes a quick moment to appreciate the artistry of the room *",
        "* turns on a scented candle to create a relaxing environment *",
    ]
];

function format_time($time_str) {
    $time = strtotime($time_str);
    $hour = date('g', $time);
    $minute = date('i', $time);
    $ampm = date('a', $time);
    $phrase = '';
    $period = '';
    
    if ($minute == 0) {
        $phrase = "$hour o'clock";
    } else if ($minute == 30) {
        $phrase = "half past $hour";
    } else if ($minute == 15) {
        $phrase = "quarter past $hour";
    } else if ($minute == 45) {
        $phrase = "quarter to " . (($hour < 12) ? $hour + 1 : 1);
    } else if ($minute < 30) {
        $phrase = "$minute minutes past $hour";
    } else {
        $phrase = (60 - $minute) . " minutes to " . ($hour + 1);
    }

    if( $ampm == 'am' && ( $hour >= 6 && $hour < 12 ) )
        $period = 'in the morning';
    if( $ampm == 'pm' && ( $hour == 12 || $hour < 6 ) )
        $period = 'in the afternoon';
        if( $ampm == 'pm' && ( $hour >= 6 && $hour < 9 ) )
        $period = 'in the evening';
    if( ( $ampm == 'pm' && $hour >= 9 ) || ( $ampm == 'am' && $hour < 6 ) )
        $period = 'at night';
    
    return $phrase . " " . $period;
}

// Check if the message is set
if (isset($_POST['message'])) {
    // Get the user's message
    $message = strtolower(trim($_POST['message']));
    
    // Predict the user's intended question based on the input
    $predicted_response = null;
    foreach ($responses as $key => $value) {
        similar_text($message, $key, $percent);
        if ($percent > 70) {
            $predicted_response = $responses[$key];
            break;
        }
    }
    
    // If a predicted response was found, select a random response for the given message
    if ($predicted_response) {
        $response = $predicted_response[array_rand($predicted_response)];
    } else {
        // Display a stock message when there is no match
        $response = "I'm sorry, I didn't understand your message.";
    }

    // Return the response as JSON
    header('Content-Type: application/json');
    echo json_encode(['message' => $response]);
}
